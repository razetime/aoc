#!/usr/bin/env cbqn

âŸ¨Split, B2D, _base, Range, Pad, _fix, SR, MatMulâŸ© â† â€¢Import "lib.bqn"

inp â† >13â†‘Â¨â€¢FLines "23t.txt"

ps â† "AABBCCDD"âˆ¾Â¨âˆ¾{(Â¯1âŒˆğ•©-'A')âŠ”â†•â‰¢ğ•©}inp
plcs â† 1âˆ¾Â¨âŸ¨1,2,4,6,8,10,11âŸ©

InPos â† {lâ€¿râ€¿c:(c=3+2Ã—l-'A')âˆ§r>1}
Dist â† {râ€¿c ğ•Š r1â€¿c1: (|r-1)+(|r1-1)+|c-c1}
minScore â† âˆ
cache â† âŸ¨âŸ©
res â† âŸ¨âŸ©
Print â† {gâ†(â‰¢inp)â¥Š' ', gâŠ£{g (âŠ‘ğ•©)âŒ¾((1â†“ğ•©)âŠ¸âŠ‘)â†©}Â¨ğ•©}

â€¢Show 0{
  score Move pos:  (â‰ cache) > i â† âŠ‘âŸ¨posâŸ©âŠËœcache ? â€¢Show score + iâŠ‘res;
  #score Move pos:  score > minScore ? score; 
  score Move pos:  âˆ§Â´InPosÂ¨pos ? minScore âŒŠâ†© score, score; 
  score Move pos:
  psn â† 1â†“Â¨pos #just the postions.
  thing â† {
    InPos i â† ğ•©âŠ‘pos ? 3=1âŠ‘i ? #â€¢Show ğ•©âŠ‘pos, 
    minScore;
    âˆ§Â´InPosÂ¨ pos/Ëœ(âŠ‘ğ•©âŠ‘pos)=âŠ‘Â¨pos ? #â€¢Show ğ•©âŠ‘pos,
     minScore;
    3=1âŠ‘i â† ğ•©âŠ‘pos ? âŠ‘(â‹ˆÂ¯1â€¿0+1â†“i)âˆŠpsn ? #â€¢Show ğ•©âŠ‘pos,
     minScore;
    ğ•Š ind:
    lâ€¿râ€¿c â† ğ•©âŠ‘pos
    # â€¢Show "poses now:"â€¿pos
    #â€¢Show lâ€¿râ€¿c
    lc â† Â¯1âŠ‘0âˆ¾câŠ¸>âŠ¸/Â¯1âŠ‘Â¨lrâ†âˆ§(1=âŠ‘Â¨)âŠ¸/psn # leftmost column with a block
    #â€¢Show lc
    rc â† âŠ‘12âˆ¾ËœcâŠ¸<âŠ¸/Â¯1âŠ‘Â¨rrâ†âˆ§(1=âŠ‘Â¨)âŠ¸/psn   # rightmost column with a block
    #â€¢Show rc
    Valid â† {ğ•Š râ€¿c: (c>lc)âˆ§c<rc}Â¨âŠ¸/
    hall â† {1=r? âŸ¨âŸ©; Valid plcs}(Â¬âˆ˜âˆŠ/âŠ£)psn # visitable hallway positions
    room â† {âˆ¨Â´{ğ•Š l1â€¿r1â€¿c1: (l1â‰ l)âˆ§c1=3+2Ã—l-'A'}Â¨pos ? âŸ¨âŸ©; Valid ((3+2Ã—l-'A')âˆ¾ËœÂ¨2â€¿3)(Â¬âˆ˜âˆŠ/âŠ£)psn} # last room position visitable
    # â€¢Show hallâˆ¾room
    #{score=0 ? â€¢Show lâˆ¾"complete",@;@}
    âŒŠÂ´{
      sâ†score + (10â‹†l-'A')Ã—ğ•© Dist râ€¿c
      #â€¢Show lâ€¿râ€¿câ‹ˆlcâ€¿lrâ€¿rcâ€¿rr, â€¢Show Print â€¢Show posâˆ¾â‹ˆ(l+32)âˆ¾ğ•©, 
      #â€¢Show "sc"â€¿s
      p â† (lâˆ¾ğ•©)âŒ¾(indâŠ¸âŠ‘) pos
      ns â† s Move p
      cache âˆ¾â†© âŸ¨pâŸ©
      res âˆ¾â†© ns-s
      ns
    }Â¨ hallâˆ¾(-Ã—â‰ room)â†‘room
  }Â¨â†•â‰ pos
  # cache âˆ¾â†© âŸ¨posâŸ©
  # res âˆ¾â†© thing
  â€¢Show Print pos
  â€¢Show pos/ËœâŒŠÂ´âŠ¸= â€¢Show thing
  
  â€¢Show âŒŠÂ´thing
} ps

#â€¢Show >cache PrintâŠ¸â‹ˆÂ¨res
â€¢Show "min"â€¿minScore