lâ†â€¢Import "../../lib.bqn"
iâ†{(l.DecÂ¨','âŠ¸l.Split)Â¨((â‰ sp)â¥Š1â€¿0)/spâ†' ' l.Split ğ•©}Â¨â€¢FLines "../inp/14"

wâ†âˆ¾{(<ğ•¨)+(â†•1+âŒˆÂ´|d)Ã—<Ã—dâ†ğ•©-ğ•¨}Â´Â¨âˆ¾(<Ë˜2âŠ¸â†•)Â¨i
bâ†âŒˆÂ´w

Simâ†{
  # walls, sand
  chkâ€¿updâ€¿fchk ğ•Š wsâ€¿ss:
  sâ€¿nâ†{
    sâ€¿n:
    nxtâ†âŸ¨0â€¿1,Â¯1â€¿1,1â€¿1âŸ©+<s
    nxt(Â¬âˆŠâŸœ(wsâˆ¾ss))âŠ¸/â†©
    nxt Updâ†©
    âŸ¨âŠ‘nxtâˆ¾â‹ˆs,0<â‰ nxtâŸ©
  }â€¢_while_{sâ€¿n:nâˆ§Chk s} âŸ¨500â€¿0,1âŸ©
  {FChk s? s; 0}
}

Partâ†{
  ğ•Š fns:
  âŠ‘{
    ssâ€¿Â·:
    {0=1000|lâ†â‰ ss?â€¢Show l;@}
    râ†fns Sim âŸ¨w,âŠ‘ğ•©âŸ©
    # â€¢Show r
    âŸ¨ssâˆ¾(râ‰¢0)/â‹ˆr,râ‰¢0âŸ©
  }â€¢_while_ {Â·â€¿c:c} âŸ¨âŸ©â€¿1
}
â€¢Show â‰ Part âŸ¨{(ğ•©â‰¥0â€¿0)âˆ§â—‹(âˆ§Â´)ğ•©â‰¤b},âŠ¢,{(ğ•©â‰¥0â€¿0)âˆ§â—‹(âˆ§Â´)ğ•©â‰¤b}âŸ© 
# Part 2 takes very, vey long. About a minute per 1000 particles.
â€¢Show 1+â‰ Part âŸ¨1,((2+1âŠ‘b)>(1âŠ¸âŠ‘)Â¨)âŠ¸/,500â€¿0âŠ¸â‰¢âŸ©
